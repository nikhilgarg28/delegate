id: 39
title: Add notification sounds for task completion and messages
description: "Add subtle browser notification sounds when key events happen, so the\
  \ user can tab away and come back when needed.\n\n## When to Play Sounds\n\n1. **New\
  \ chat message arrives** \u2014 when a new message appears in the chat log that\
  \ wasn't there before (compare message count or latest message ID on each 2-second\
  \ poll). Only play if the message is NOT from the currently-selected sender (i.e.\
  \ not the user's own message echo).\n\n2. **Task status changes to 'done' or 'review'**\
  \ \u2014 when loading tasks and a task transitions from a non-terminal status to\
  \ 'done' or 'review' compared to the last poll.\n\n## Sound Generation\n\nUse the\
  \ Web Audio API to synthesize sounds \u2014 NO external audio files. This keeps\
  \ it self-contained in the single-file web.py HTML.\n\nTwo distinct sounds:\n- **Message\
  \ notification**: A soft two-tone 'ding-ding' \u2014 short sine wave at ~800Hz for\
  \ 80ms, then ~1000Hz for 80ms, with fast decay. Volume: 0.15 (subtle).\n- **Task\
  \ completion notification**: A pleasant three-note ascending chime \u2014 600Hz,\
  \ 800Hz, 1000Hz, each 100ms with 50ms gaps, sine wave with decay. Volume: 0.12 (even\
  \ more subtle).\n\nCreate helper functions:\n- playMsgSound() \u2014 plays the message\
  \ notification\n- playTaskSound() \u2014 plays the task completion notification\n\
  \nBoth should create a new AudioContext on first call (lazily, since browsers block\
  \ AudioContext before user interaction) and reuse it.\n\n## Integration into Refresh\
  \ Loop\n\n### Chat polling (loadChat):\n- Before rebuilding the chat log, compare\
  \ the new messages count or last message timestamp with the previous. If there are\
  \ new messages and the newest message sender is NOT the current user's configured\
  \ sender, call playMsgSound().\n- Store previous message count or last timestamp\
  \ in a module-level variable (e.g. _lastMsgCount, _lastMsgTimestamp).\n\n### Task\
  \ polling (loadTasks):\n- Before re-rendering, compare each task's status with a\
  \ cached previous status map. If any task transitions TO 'done' or 'review' (and\
  \ was previously something else), call playTaskSound().\n- Store a Map of taskId\
  \ -> status from the previous poll (e.g. _prevTaskStatuses).\n\n## User Preference\n\
  \nAdd a small mute/unmute toggle button in the header (next to the tabs):\n- \U0001F514\
  \ (unmuted, default) / \U0001F515 (muted)\n- Style: background transparent, border\
  \ none, color #555, hover color #999, cursor pointer, font-size 14px, padding 4px\
  \ 8px\n- Store preference in localStorage key 'standup-muted' (values: 'true'/'false')\n\
  - When muted, playMsgSound() and playTaskSound() are no-ops\n- Default: unmuted\
  \ (sounds enabled)\n\n## Implementation Details\n\nAll changes in scripts/web.py.\
  \ No external dependencies.\n\nThe AudioContext must be created after user interaction\
  \ (browser policy). Use a lazy init pattern: on the first call to either play function,\
  \ create the AudioContext if it doesn't exist. If creation fails (e.g. user hasn't\
  \ interacted yet), silently skip.\n\nKeep the sound generation code compact \u2014\
  \ each play function should be ~15 lines max.\n\nCode lives in /Users/nikhil/dev/standup/.\n\
  Branch convention: mark/standup-ui/039-notification-sounds\nMessage edison when\
  \ done."
status: done
assignee: mark
reviewer: ''
project: standup-ui
priority: medium
created_at: '2026-02-08T19:46:32.697338Z'
updated_at: '2026-02-08T19:55:29.197996Z'
completed_at: '2026-02-08T19:55:29.194782Z'
depends_on: []
branch: ''
commits: []
